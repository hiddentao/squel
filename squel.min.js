/*! squel | https://github.com/hiddentao/squel | BSD license */"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var l=Object.getPrototypeOf(e);return null===l?void 0:t(l,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd?define([],function(){return t.returnExportsGlobal=e()}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e():t.squel=e()}(void 0,function(){function t(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];if(r){var i=!0,l=!1,a=void 0;try{for(var o,s=function(){var e=o.value;e&&Object.getOwnPropertyNames(e).forEach(function(r){"function"!=typeof e[r]&&(t[r]=e[r])})},u=r[Symbol.iterator]();!(i=(o=u.next()).done);i=!0)s()}catch(c){l=!0,a=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw a}}}return t}function e(t){return t&&t.constructor.prototype===Object.prototype}function r(t){return t&&t.constructor.prototype===Array.prototype}function n(t){if(t&&t.constructor&&t.constructor.toString){var e=t.constructor.toString().match(/function\s*(\w+)/);if(e&&2===e.length)return e[1]}}function i(t){if(!t)return t;if("function"==typeof t.clone)return t.clone();if(!e(t)&&!r(t))return JSON.parse(JSON.stringify(t));var n=function(){var e=new t.constructor;return Object.getOwnPropertyNames(t).forEach(function(r){"function"!=typeof t[r]&&(e[r]=i(t[r]))}),{v:e}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function l(t,e,r){var n="undefined"==typeof e?"undefined":_typeof(e);if("function"!==n&&"string"!==n)throw new Error("type must be a class constructor or string");if("function"!=typeof r)throw new Error("handler must be a function");var i=!0,l=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;if(u.type===e)return void(u.handler=r)}}catch(c){l=!0,a=c}finally{try{!i&&s["return"]&&s["return"]()}finally{if(l)throw a}}t.push({type:e,handler:r})}function a(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];var i=!0,l=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value,c=!0,f=!1,h=void 0;try{for(var v,d=u[Symbol.iterator]();!(c=(v=d.next()).done);c=!0){var y=v.value;if(("undefined"==typeof t?"undefined":_typeof(t))===y.type||"string"!=typeof y.type&&t instanceof y.type)return y.handler}}catch(p){f=!0,h=p}finally{try{!c&&d["return"]&&d["return"]()}finally{if(f)throw h}}}}catch(p){l=!0,a=p}finally{try{!i&&s["return"]&&s["return"]()}finally{if(l)throw a}}}function o(){var o=arguments.length<=0||void 0===arguments[0]?null:arguments[0],s={_getObjectClassName:n};s.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" "},s.globalValueHandlers=[],s.registerValueHandler=function(t,e){l(s.globalValueHandlers,t,e)},s.Cloneable=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"clone",value:function(){var e=new this.constructor;return t(e,i(t({},this)))}}]),e}(),s.BaseBuilder=function(e){function n(e){_classCallCheck(this,n);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this)),i=JSON.parse(JSON.stringify(s.DefaultQueryBuilderOptions));return r.options=t({},i,e),r}return _inherits(n,e),_createClass(n,[{key:"registerValueHandler",value:function(t,e){return l(this.options.valueHandlers,t,e),this}},{key:"_sanitizeCondition",value:function(t){if(!(t instanceof s.Expression)&&"string"!=typeof t)throw new Error("condition must be a string or Expression instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error(e+" must be a string");return t}},{key:"_sanitizeField",value:function(t){var e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t instanceof s.QueryBuilder?t="("+t+")":(t=this._sanitizeName(t,"field name"),this.options.autoQuoteFieldNames&&!function(){var n=e.options.nameQuoteCharacter;t=r.ignorePeriodsForFieldNameQuotes?""+n+t+n:t.split(".").map(function(t){return"*"===t?t:""+n+t+n}).join(".")}()),t}},{key:"_sanitizeNestableQuery",value:function(t){if(t instanceof s.QueryBuilder&&t.isNestable())return t;throw new Error("must be a nestable query, e.g. SELECT")}},{key:"_sanitizeTable",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(e){if("string"!=typeof t)try{t=this._sanitizeNestableQuery(t)}catch(r){throw new Error("table name must be a string or a nestable query instance")}}else t=this._sanitizeName(t,"table name");if(this.options.autoQuoteTableNames){var n=this.options.nameQuoteCharacter;return""+n+t+n}return t}},{key:"_sanitizeTableAlias",value:function(t){var e=this._sanitizeName(t,"table alias");if(this.options.autoQuoteAliasNames){var r=this.options.tableAliasQuoteCharacter;e=""+r+e+r}return this.options.useAsForTableAliasNames?"AS "+e:e}},{key:"_sanitizeFieldAlias",value:function(t){var e=this._sanitizeName(t,"field alias");if(this.options.autoQuoteAliasNames){var r=this.options.fieldAliasQuoteCharacter;return""+r+e+r}return e}},{key:"_sanitizeLimitOffset",value:function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e="undefined"==typeof t?"undefined":_typeof(t);if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(t instanceof s.QueryBuilder&&t.isNestable());else if(t instanceof s.FunctionBlock);else{var r=!!a(t,this.options.valueHandlers,s.globalValueHandlers);if(!r)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatCustomValue",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],r=a(t,this.options.valueHandlers,s.globalValueHandlers);return r&&(t=r(t,e)),t}},{key:"_formatValueAsParam",value:function(t){var e=this;return r(t)?t.map(function(t){return e._formatValueAsParam(t)}):t instanceof s.QueryBuilder&&t.isNestable()?(t.updateOptions({nestedBuilder:!0}),t.toParam()):t instanceof s.Expression?t.toParam():this._formatCustomValue(t,!0)}},{key:"_formatValue",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=this._formatCustomValue(t);if(i!==t)return"("+i+")";if(r(t))t=t.map(function(t){return e._formatValue(t)}),t="("+t.join(", ")+")";else{var l="undefined"==typeof t?"undefined":_typeof(t);if(null===t)t="NULL";else if("boolean"===l)t=t?"TRUE":"FALSE";else if(t instanceof s.QueryBuilder)t="("+t+")";else if(t instanceof s.Expression)t="("+t+")";else if("number"!==l)if(n.dontQuote)t=""+t;else{var a=this._escapeValue(t);t="'"+a+"'"}}return t}}]),n}(s.Cloneable),s.Expression=function(e){function n(e){_classCallCheck(this,n);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this)),i=JSON.parse(JSON.stringify(s.DefaultQueryBuilderOptions));return r.options=t({},i,e),r.tree={nodes:[]},r.stack=[],r}return _inherits(n,e),_createClass(n,[{key:"_begin",value:function(t){var e={type:t,nodes:[]},r=this._current();return this.stack.push(r.nodes.length),r.nodes.push(e),this}},{key:"_current",value:function(){var t=this.tree,e=!0,r=!1,n=void 0;try{for(var i,l=this.stack[Symbol.iterator]();!(e=(i=l.next()).done);e=!0){var a=i.value;t=t.nodes[a]}}catch(o){r=!0,n=o}finally{try{!e&&l["return"]&&l["return"]()}finally{if(r)throw n}}return t}},{key:"and_begin",value:function(){return this._begin("AND")}},{key:"or_begin",value:function(){return this._begin("OR")}},{key:"end",value:function(){if(!this.stack.length)throw new Error("begin() needs to be called");return this.stack.pop(),this}},{key:"and",value:function(t,e){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this._current().nodes.push({type:"AND",expr:t,para:e}),this}},{key:"or",value:function(t,e){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this._current().nodes.push({type:"OR",expr:t,para:e}),this}},{key:"toString",value:function(){if(this.stack.length)throw new Error("end() needs to be called");return this._toString(this.tree)}},{key:"toParam",value:function(){if(this.stack.length)throw new Error("end() needs to be called");return this._toString(this.tree,!0)}},{key:"_toString",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i="",l=[],a=!0,o=!1,s=void 0;try{for(var u,c=t.nodes[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var f=u.value,h=void 0;if(void 0!==f.expr){if(h=f.expr,void 0!==f.para)if(n){var v=this._formatValueAsParam(f.para);if(v&&v.text?(l=l.concat(v.values),h=h.replace(this.options.parameterCharacter,"("+v.text+")")):l=l.concat(v),r(f.para)){var d=Array.apply(null,new Array(f.para.length)),y=d.map(function(){return e.options.parameterCharacter});h=h.replace(this.options.parameterCharacter,"("+y.join(", ")+")")}}else h=h.replace(this.options.parameterCharacter,this._formatValue(f.para))}else h=this._toString(f,n),n&&(l=l.concat(h.values),h=h.text),h.length&&(h="("+h+")");h.length&&(i.length&&(i+=" "+f.type+" "),i+=h)}}catch(p){o=!0,s=p}finally{try{!a&&c["return"]&&c["return"]()}finally{if(o)throw s}}return n?{text:i,values:l}:i}}]),n}(s.BaseBuilder),s.Case=function(r){function n(r){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,n);var l=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this));return e(r)&&(i=r,r=null),r&&(l.fieldName=l._sanitizeField(r)),l.options=t({},s.DefaultQueryBuilderOptions,i),l.cases=[],l.elseValue=null,l}return _inherits(n,r),_createClass(n,[{key:"when",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return this.cases.unshift({expression:t,values:r}),this}},{key:"then",value:function(t){if(0==this.cases.length)throw new Error("when() needs to be called first");return this.cases[0].result=t,this}},{key:"else",value:function(t){return this.elseValue=t,this}},{key:"toString",value:function(){return this._toString(this.cases,this.elseValue)}},{key:"toParam",value:function(){return this._toString(this.cases,this.elseValue,!0)}},{key:"_toString",value:function(t,e){var r=this,n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];if(0==t.length)return this._formatValue(e);var i=[];t=t.map(function(t){var e=new s.AbstractConditionBlock("WHEN");e._condition.apply(e,[t.expression].concat(t.values));var l="";return n?(e=e.buildParam(),l=e.text,i=i.concat(e.values)):l=e.buildStr(),l+" THEN "+r._formatValue(t.result)});var l=t.join(" ")+" ELSE "+this._formatValue(e)+" END";return this.fieldName&&(l=this.fieldName+" "+l),l="CASE "+l,n?{text:l,values:i}:l}}]),n}(s.BaseBuilder),s.Block=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t))}return _inherits(e,t),_createClass(e,[{key:"exposedMethods",value:function(){for(var t={},e=this;e;)Object.getOwnPropertyNames(e).forEach(function(r){"constructor"===r||"function"!=typeof e[r]||"_"===r.charAt(0)||s.Block.prototype[r]||(t[r]=e[r])}),e=Object.getPrototypeOf(e);return t}},{key:"buildStr",value:function(t){return""}},{key:"buildParam",value:function(t){return{text:this.buildStr(t),values:[]}}}]),e}(s.BaseBuilder),s.StringBlock=function(t){function e(t,r){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return n.str=r,n}return _inherits(e,t),_createClass(e,[{key:"buildStr",value:function(t){return this.str}}]),e}(s.Block),s.AbstractValueBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._str="",r._values=[],r}return _inherits(e,t),_createClass(e,[{key:"_setValue",value:function(t){this._str=t;for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._values=r}},{key:"buildStr",value:function(t){var e=this._str,r="",n=[].concat(this._values),i=!0,l=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;this.options.parameterCharacter===u&&0<n.length&&(u=n.shift()),r+=u}}catch(c){l=!0,a=c}finally{try{!i&&s["return"]&&s["return"]()}finally{if(l)throw a}}return r}},{key:"buildParam",value:function(t){return{text:this._str,values:this._values}}}]),e}(s.Block),s.FunctionBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"function",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._setValue.apply(this,[t].concat(r))}}]),e}(s.AbstractValueBlock),s.fval=function(){var t=new s.FunctionBlock;return t["function"].apply(t,arguments),t},s.registerValueHandler(s.FunctionBlock,function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return e?t.buildParam():t.buildStr()}),s.AbstractTableBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.tables=[],r}return _inherits(e,t),_createClass(e,[{key:"_table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];e&&(e=this._sanitizeTableAlias(e)),t=this._sanitizeTable(t,!!this.options.allowNested),this.options.singleTable&&(this.tables=[]),this.tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this.tables.length}},{key:"buildStr",value:function(t){if(!this._hasTable())return"";var e="",r=!0,n=!1,i=void 0;try{for(var l,a=this.tables[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var o=l.value;e.length&&(e+=", "),e+="string"==typeof o.table?o.table:"("+o.table+")",o.alias&&(e+=" "+o.alias)}}catch(s){n=!0,i=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}return e}},{key:"_buildParam",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r={text:"",values:[]},n=[],i="";if(!this._hasTable())return r;var l=!0,a=!1,o=void 0;try{for(var u,c=this.tables[Symbol.iterator]();!(l=(u=c.next()).done);l=!0){var f=u.value,h=void 0;"string"==typeof f.table?h={text:""+f.table,values:[]}:f.table instanceof s.QueryBuilder?(f.table.updateOptions({nestedBuilder:!0}),h=f.table.toParam()):(f.updateOptions({nestedBuilder:!0}),h=f.buildParam(t)),h.table=f,n.push(h)}}catch(v){a=!0,o=v}finally{try{!l&&c["return"]&&c["return"]()}finally{if(a)throw o}}var d=!0,y=!1,p=void 0;try{for(var b,_=n[Symbol.iterator]();!(d=(b=_.next()).done);d=!0){var k=b.value;i.length?i+=", ":e&&e.length&&(i+=e+" "+i),i+="string"==typeof k.table.table?""+k.text:"("+k.text+")",k.table.alias&&(i+=" "+k.table.alias);var g=!0,m=!1,C=void 0;try{for(var O,w=k.values[Symbol.iterator]();!(g=(O=w.next()).done);g=!0){var B=O.value;r.values.push(this._formatCustomValue(B))}}catch(v){m=!0,C=v}finally{try{!g&&w["return"]&&w["return"]()}finally{if(m)throw C}}}}catch(v){y=!0,p=v}finally{try{!d&&_["return"]&&_["return"]()}finally{if(y)throw p}}return r.text+=i,r}},{key:"buildParam",value:function(t){return this._buildParam(t)}}]),e}(s.Block),s.UpdateTableBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}}]),e}(s.AbstractTableBlock),s.FromTableBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"from",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}},{key:"buildStr",value:function(t){var r=_get(Object.getPrototypeOf(e.prototype),"buildStr",this).call(this,t);return r.length?"FROM "+r:""}},{key:"buildParam",value:function(t){return this._buildParam(t,"FROM")}}]),e}(s.AbstractTableBlock),s.IntoTableBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.table=null,r}return _inherits(e,t),_createClass(e,[{key:"into",value:function(t){this.table=this._sanitizeTable(t,!1)}},{key:"buildStr",value:function(t){if(!this.table)throw new Error("into() needs to be called");return"INTO "+this.table}}]),e}(s.Block),s.GetFieldBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._fieldAliases={},r._fields=[],r}return _inherits(e,t),_createClass(e,[{key:"fields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(r(t)){var n=!0,i=!1,l=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.field(s,null,e)}}catch(u){i=!0,l=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw l}}}else for(var c in t){var f=t[c];this.field(c,f,e)}}},{key:"field",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e&&(e=this._sanitizeFieldAlias(e)),this._fieldAliases.hasOwnProperty(t)&&this._fieldAliases[t]===e)return this;var n={alias:e};t instanceof s.Case?n.func=t:n.name=this._sanitizeField(t,r),r.aggregation&&(n.aggregation=r.aggregation),this._fieldAliases[t]=e,this._fields.push(n)}},{key:"buildStr",value:function(t){return this._build(t)}},{key:"buildParam",value:function(t){return this._build(t,!0)}},{key:"_build",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(!t.getBlock(s.FromTableBlock)._hasTable())return e?{text:"",values:[]}:"";var r="",n=[],i=!0,l=!1,a=void 0;try{for(var o,u=this._fields[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var c=o.value;if(r.length&&(r+=", "),c.aggregation&&(r+=c.aggregation+"("),c.func)if(e){var f=c.func.toParam();r+=f.text,n=n.concat(f.values)}else r+=c.func.toString();else r+=c.name;c.aggregation&&(r+=")"),c.alias&&(r+=" AS "+c.alias)}}catch(h){l=!0,a=h}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw a}}return r.length||(r="*"),e?{text:r,values:n}:r}}]),e}(s.Block),s.AbstractSetFieldBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.fieldOptions=[],r.fields=[],r.values=[],r}return _inherits(e,t),_createClass(e,[{key:"_set",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(this.values.length>1)throw new Error("Cannot call set or setFields on multiple rows of fields.");void 0!==e&&(e=this._sanitizeValue(e));var n=this.fields.indexOf(this._sanitizeField(t,r));-1!==n?(this.values[0][n]=e,this.fieldOptions[0][n]=r):(this.fields.push(this._sanitizeField(t,r)),n=this.fields.length-1,Array.isArray(this.values[0])?(this.values[0][n]=e,this.fieldOptions[0][n]=r):(this.values.push([e]),this.fieldOptions.push([r])))}},{key:"_setFields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof t?"undefined":_typeof(t)))throw new Error("Expected an object but got "+("undefined"==typeof t?"undefined":_typeof(t)));for(var r in t)this._set(r,t[r],e)}},{key:"_setFieldsRows",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!r(t))throw new Error("Expected an array of objects but got "+("undefined"==typeof t?"undefined":_typeof(t)));this.fields=[],this.values=[];for(var n in t){var i=t[n];for(var l in i){var a=i[l],o=this.fields.indexOf(this._sanitizeField(l,e));if(n>0&&-1===o)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===o&&(this.fields.push(this._sanitizeField(l,e)),o=this.fields.length-1),a=this._sanitizeValue(a),r(this.values[n])?(this.values[n][o]=a,this.fieldOptions[n][o]=e):(this.values[n]=[a],this.fieldOptions[n]=[e])}}}},{key:"buildStr",value:function(){throw new Error("Not yet implemented")}},{key:"buildParam",value:function(){throw new Error("Not yet implemented")}}]),e}(s.Block),s.SetFieldBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"set",value:function(t,e,r){this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"buildStr",value:function(t){if(0>=this.fields.length)throw new Error("set() needs to be called");var e="";for(var r in this.fields){e.length&&(e+=", ");var n=this.fields[r],i=this.values[0][r],l=this.fieldOptions[0][r];e+="undefined"==typeof i?n:n+" = "+this._formatValue(i,l)}return"SET "+e}},{key:"buildParam",value:function(t){if(0>=this.fields.length)throw new Error("set() needs to be called");var e="",r=[];for(var n in this.fields){e.length&&(e+=", ");var i=this.fields[n],l=this.values[0][n];if("undefined"==typeof l)e+=i;else{var a=this._formatValueAsParam(l);if(a&&a.text){e+=i+" = ("+a.text+")";var o=!0,s=!1,u=void 0;try{for(var c,f=a.values[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var h=c.value;r.push(h)}}catch(v){s=!0,u=v}finally{try{!o&&f["return"]&&f["return"]()}finally{if(s)throw u}}}else e+=i+" = "+this.options.parameterCharacter,r.push(a)}}return{text:"SET "+e,values:r}}}]),e}(s.AbstractSetFieldBlock),s.InsertFieldValueBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"set",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_buildVals",value:function(){var t=[];for(var e in this.values)for(var r in this.values[e]){var n=this._formatValue(this.values[e][r],this.fieldOptions[e][r]);"string"==typeof t[e]?t[e]+=", "+n:t[e]=""+n}return t}},{key:"_buildValParams",value:function(){var t=[],e=[];for(var r in this.values)for(var n in this.values[r]){var i=this._formatValueAsParam(this.values[r][n]),l=void 0;if(i&&i.text){l=i.text;var a=!0,o=!1,s=void 0;try{for(var u,c=i.values[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var f=u.value;e.push(f)}}catch(h){o=!0,s=h}finally{try{!a&&c["return"]&&c["return"]()}finally{if(o)throw s}}}else l=this.options.parameterCharacter,e.push(i);"string"==typeof t[r]?t[r]+=", "+l:t[r]=l}return{vals:t,params:e}}},{key:"buildStr",value:function(t){return 0>=this.fields.length?"":"("+this.fields.join(", ")+") VALUES ("+this._buildVals().join("), (")+")"}},{key:"buildParam",value:function(t){if(0>=this.fields.length)return{text:"",values:[]};var e="",r=this._buildValParams(),n=r.vals,i=r.params;for(var l in this.fields)e.length&&(e+=", "),e+=this.fields[l];return{text:"("+e+") VALUES ("+n.join("), (")+")",values:i}}}]),e}(s.AbstractSetFieldBlock),s.InsertFieldsFromQueryBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._fields=[],r._query=null,r}return _inherits(e,t),_createClass(e,[{key:"fromQuery",value:function(t,e){var r=this;this._fields=t.map(function(t){return r._sanitizeField(t)}),this._query=this._sanitizeNestableQuery(e)}},{key:"buildStr",value:function(t){return 0>=this._fields.length?"":"("+this._fields.join(", ")+") ("+this._query.toString()+")"}},{key:"buildParam",value:function(t){if(0>=this._fields.length)return{text:"",values:[]};this._query.updateOptions({nestedBuilder:!0});var e=this._query.toParam();return{text:"("+this._fields.join(", ")+") ("+e.text+")",values:e.values}}}]),e}(s.Block),s.DistinctBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.useDistinct=!1,r}return _inherits(e,t),_createClass(e,[{key:"distinct",value:function(){this.useDistinct=!0}},{key:"buildStr",value:function(t){return this.useDistinct?"DISTINCT":""}}]),e}(s.Block),s.GroupByBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.groups=[],r}return _inherits(e,t),_createClass(e,[{key:"group",value:function(t){t=this._sanitizeField(t),this.groups.push(t)}},{key:"buildStr",value:function(t){if(0<this.groups.length){var e=this.groups.join(", ");return"GROUP BY "+e}return""}}]),e}(s.Block),s.OffsetBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.offsets=null,r}return _inherits(e,t),_createClass(e,[{key:"offset",value:function(t){t=this._sanitizeLimitOffset(t),this.offsets=t}},{key:"buildStr",value:function(t){return this.offsets?"OFFSET "+this.offsets:""}}]),e}(s.Block),s.AbstractConditionBlock=function(t){function e(t,r){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,r));return n.conditionVerb=t,n.conditions=[],n}return _inherits(e,t),_createClass(e,[{key:"_condition",value:function(t){var e=this;t=this._sanitizeCondition(t);var n="",i=[];if(t instanceof s.Expression){var l=t.toParam();n=l.text,i=l.values}else{for(var a=arguments.length,o=Array(a>1?a-1:0),u=1;a>u;u++)o[u-1]=arguments[u];for(var c in t){var f=t.charAt(c);if(this.options.parameterCharacter===f&&0<o.length){var h=o.shift();if(r(h)){var v=[],d=!0,y=!1,p=void 0;try{for(var b,_=h[Symbol.iterator]();!(d=(b=_.next()).done);d=!0){var k=b.value;v.push(this._sanitizeValue(k))}}catch(g){y=!0,p=g}finally{try{!d&&_["return"]&&_["return"]()}finally{if(y)throw p}}i=i.concat(v);var m=v.map(function(){return e.options.parameterCharacter});n+="("+m.join(", ")+")"}else n+=this.options.parameterCharacter,i.push(this._sanitizeValue(h))}else n+=f}}n.length&&this.conditions.push({text:n,values:i})}},{key:"buildStr",value:function(t){if(0>=this.conditions.length)return"";var e="",r=!0,n=!1,i=void 0;try{for(var l,a=this.conditions[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var o=l.value;if(e.length&&(e+=") AND ("),0<o.values.length){var s=0,u=!0,c=!1,f=void 0;try{for(var h,v=o.text[Symbol.iterator]();!(u=(h=v.next()).done);u=!0){var d=h.value;e+=this.options.parameterCharacter===d?this._formatValue(o.values[s++]):d}}catch(y){c=!0,f=y}finally{try{!u&&v["return"]&&v["return"]()}finally{if(c)throw f}}}else e+=o.text}}catch(y){n=!0,i=y}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}return this.conditionVerb+" ("+e+")"}},{key:"buildParam",value:function(t){var e={text:"",values:[]};if(0>=this.conditions.length)return e;var r="",n=!0,i=!1,l=void 0;try{for(var a,o=this.conditions[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;r.length&&(r+=") AND (");var u=s.text.split(this.options.parameterCharacter),c=0,f=!0,h=!1,v=void 0;try{for(var d,y=s.values[Symbol.iterator]();!(f=(d=y.next()).done);f=!0){var p=d.value;void 0!==u[c]&&(r+=u[c]);var b=this._formatValueAsParam(p);if(b&&b.text){r+="("+b.text+")";var _=!0,k=!1,g=void 0;try{for(var m,C=b.values[Symbol.iterator]();!(_=(m=C.next()).done);_=!0){var O=m.value;e.values.push(O)}}catch(w){k=!0,g=w}finally{try{!_&&C["return"]&&C["return"]()}finally{if(k)throw g}}}else r+=this.options.parameterCharacter,e.values.push(b);c+=1}}catch(w){h=!0,v=w}finally{try{!f&&y["return"]&&y["return"]()}finally{if(h)throw v}}void 0!==u[c]&&(r+=u[c])}}catch(w){i=!0,l=w}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw l}}return e.text=this.conditionVerb+" ("+r+")",e}}]),e}(s.Block),s.WhereBlock=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,"WHERE",t))}return _inherits(e,t),_createClass(e,[{key:"where",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[t].concat(r))}}]),e}(s.AbstractConditionBlock),s.HavingBlock=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,"HAVING",t))}return _inherits(e,t),_createClass(e,[{key:"having",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[t].concat(r))}}]),e}(s.AbstractConditionBlock),s.OrderByBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.orders=[],r._values=[],r}return _inherits(e,t),_createClass(e,[{key:"order",value:function(t,e){t=this._sanitizeField(t),void 0===e&&(e=!0),null!==e&&(e=!!e);for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;r>i;i++)n[i-2]=arguments[i];this._values=n,this.orders.push({field:t,dir:e})}},{key:"_buildStr",value:function(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];if(0<this.orders.length){var e=0,r="",n=!0,i=!1,l=void 0;try{for(var a,o=this.orders[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;r.length&&(r+=", ");var u="";if(t)u=s.field;else{var c=!0,f=!1,h=void 0;try{for(var v,d=s.field[Symbol.iterator]();!(c=(v=d.next()).done);c=!0){var y=v.value;u+=this.options.parameterCharacter===y?this._formatValue(this._values[e++]):y}}catch(p){f=!0,h=p}finally{try{!c&&d["return"]&&d["return"]()}finally{if(f)throw h}}}r+=u,null!==s.dir&&(r+=" "+(s.dir?"ASC":"DESC"))}}catch(p){i=!0,l=p}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw l}}return"ORDER BY "+r}return""}},{key:"buildStr",value:function(t){return this._buildStr()}},{key:"buildParam",value:function(t){var e=this;return{text:this._buildStr(!0),values:this._values.map(function(t){return e._formatValueAsParam(t)})}}}]),e}(s.Block),s.LimitBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.limits=null,r}return _inherits(e,t),_createClass(e,[{key:"limit",value:function(t){t=this._sanitizeLimitOffset(t),this.limits=t}},{key:"buildStr",value:function(t){return this.limits||0==this.limits?"LIMIT "+this.limits:""}}]),e}(s.Block),s.JoinBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.joins=[],r}return _inherits(e,t),_createClass(e,[{
key:"join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=arguments.length<=3||void 0===arguments[3]?"INNER":arguments[3];t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,r=r?this._sanitizeCondition(r):r,this.joins.push({type:n,table:t,alias:e,condition:r})}},{key:"left_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"LEFT")}},{key:"right_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"RIGHT")}},{key:"outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"OUTER")}},{key:"left_outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"FULL")}},{key:"cross_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"CROSS")}},{key:"buildStr",value:function(t){var e="",r=!0,n=!1,i=void 0;try{for(var l,a=(this.joins||[])[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var o=l.value;e.length&&(e+=" "),e+=o.type+" JOIN ",e+="string"==typeof o.table?o.table:"("+o.table+")",o.alias&&(e+=" "+o.alias),o.condition&&(e+=" ON ("+o.condition+")")}}catch(s){n=!0,i=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}return e}},{key:"buildParam",value:function(t){var e={text:"",values:[]},r=[],n="";if(0>=this.joins.length)return e;var i=!0,l=!1,a=void 0;try{for(var o,u=this.joins[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var c=o.value,f=void 0;if("string"==typeof c.table?f={text:""+c.table,values:[]}:c.table instanceof s.QueryBuilder?(c.table.updateOptions({nestedBuilder:!0}),f=c.table.toParam()):(c.updateOptions({nestedBuilder:!0}),f=c.buildParam(t)),c.condition instanceof s.Expression){var h=c.condition.toParam();f.condition=h.text,f.values=f.values.concat(h.values)}else f.condition=c.condition;f.join=c,r.push(f)}}catch(v){l=!0,a=v}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw a}}var d=!0,y=!1,p=void 0;try{for(var b,_=r[Symbol.iterator]();!(d=(b=_.next()).done);d=!0){var k=b.value;n.length&&(n+=" "),n+=k.join.type+" JOIN ",n+="string"==typeof k.join.table?k.text:"("+k.text+")",k.join.alias&&(n+=" "+k.join.alias),k.condition&&(n+=" ON ("+k.condition+")");var g=!0,m=!1,C=void 0;try{for(var O,w=k.values[Symbol.iterator]();!(g=(O=w.next()).done);g=!0){var B=O.value;e.values.push(this._formatCustomValue(B))}}catch(v){m=!0,C=v}finally{try{!g&&w["return"]&&w["return"]()}finally{if(m)throw C}}}}catch(v){y=!0,p=v}finally{try{!d&&_["return"]&&_["return"]()}finally{if(y)throw p}}return e.text+=n,e}}]),e}(s.Block),s.UnionBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.unions=[],r}return _inherits(e,t),_createClass(e,[{key:"union",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"UNION":arguments[1];t=this._sanitizeTable(t,!0),this.unions.push({type:e,table:t})}},{key:"union_all",value:function(t){this.union(t,"UNION ALL")}},{key:"buildStr",value:function(t){var e="",r=!0,n=!1,i=void 0;try{for(var l,a=(this.unions||[])[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var o=l.value;e.length&&(e+=" "),e+=o.type+" ",e+="string"==typeof o.table?o.table:"("+o.table+")"}}catch(s){n=!0,i=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}return e}},{key:"buildParam",value:function(t){var e={text:"",values:[]},r=[],n="";if(0>=this.unions.length)return e;var i=!0,l=!1,a=void 0;try{for(var o,u=(this.unions||[])[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var c=o.value,f=void 0;"string"==typeof c.table?f={text:c.table,values:[]}:c.table instanceof s.QueryBuilder?(c.table.updateOptions({nestedBuilder:!0}),f=c.table.toParam()):(c.updateOptions({nestedBuilder:!0}),f=c.buildParam(t)),f.type=c.type,r.push(f)}}catch(h){l=!0,a=h}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw a}}var v=!0,d=!1,y=void 0;try{for(var p,b=r[Symbol.iterator]();!(v=(p=b.next()).done);v=!0){var _=p.value;n.length&&(n+=" "),n+=_.type+" ("+_.text+")";var k=!0,g=!1,m=void 0;try{for(var C,O=_.values[Symbol.iterator]();!(k=(C=O.next()).done);k=!0){var w=C.value;e.values.push(this._formatCustomValue(w))}}catch(h){g=!0,m=h}finally{try{!k&&O["return"]&&O["return"]()}finally{if(g)throw m}}}}catch(h){d=!0,y=h}finally{try{!v&&b["return"]&&b["return"]()}finally{if(d)throw y}}return e.text+=n,e}}]),e}(s.Block),s.QueryBuilder=function(e){function r(t,e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,t));n.blocks=e||[];var i=!0,l=!1,a=void 0;try{for(var o,s=n.blocks[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value,c=u.exposedMethods();for(var f in c){var h=c[f];if(void 0!==n[f])throw new Error("Builder already has a builder method called: "+f);!function(t,e,r){n[e]=function(){for(var e=arguments.length,i=Array(e),l=0;e>l;l++)i[l]=arguments[l];return r.call.apply(r,[t].concat(i)),n}}(u,f,h)}}}catch(v){l=!0,a=v}finally{try{!i&&s["return"]&&s["return"]()}finally{if(l)throw a}}return n}return _inherits(r,e),_createClass(r,[{key:"registerValueHandler",value:function(t,e){var n=!0,i=!1,l=void 0;try{for(var a,o=this.blocks[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.registerValueHandler(t,e)}}catch(u){i=!0,l=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw l}}return _get(Object.getPrototypeOf(r.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(e){this.options=t({},this.options,e);var r=!0,n=!1,i=void 0;try{for(var l,a=this.blocks[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var o=l.value;o.options=t({},o.options,e)}}catch(s){n=!0,i=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}}},{key:"toString",value:function(){var t=this,e=this.blocks.map(function(e){return e.buildStr(t)});return e.filter(function(t){return 0<t.length}).join(this.options.separator)}},{key:"toParam",value:function(){var e,r=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],i=this.options;n&&(this.options=t({},this.options,n));var l={text:"",values:[]},a=this.blocks.map(function(t){return t.buildParam(r)}),o=a.map(function(t){return t.text}),s=a.map(function(t){return t.values});return l.text=o.filter(function(t){return 0<t.length}).join(this.options.separator),l.values=(e=[]).concat.apply(e,_toConsumableArray(s)),this.options.nestedBuilder||this.options.numberedParameters&&!function(){var t=void 0!==r.options.numberedParametersStartAt?r.options.numberedParametersStartAt:1,e=new RegExp("\\"+r.options.parameterCharacter,"g");l.text=l.text.replace(e,function(){return""+r.options.numberedParametersPrefix+t++})}(),this.options=i,l}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"isNestable",value:function(){return!1}},{key:"getBlock",value:function(t){var e=this.blocks.filter(function(e){return e instanceof t});return e[0]}}]),r}(s.BaseBuilder),s.Select=function(e){function r(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,r),n=n||[new s.StringBlock(e,"SELECT"),new s.FunctionBlock(e),new s.DistinctBlock(e),new s.GetFieldBlock(e),new s.FromTableBlock(t({},e,{allowNested:!0})),new s.JoinBlock(t({},e,{allowNested:!0})),new s.WhereBlock(e),new s.GroupByBlock(e),new s.HavingBlock(e),new s.OrderByBlock(e),new s.LimitBlock(e),new s.OffsetBlock(e),new s.UnionBlock(t({},e,{allowNested:!0}))],_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,n))}return _inherits(r,e),_createClass(r,[{key:"isNestable",value:function(){return!0}}]),r}(s.QueryBuilder),s.Update=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new s.StringBlock(t,"UPDATE"),new s.UpdateTableBlock(t),new s.SetFieldBlock(t),new s.WhereBlock(t),new s.OrderByBlock(t),new s.LimitBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(s.QueryBuilder),s.Delete=function(e){function r(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,r),n=n||[new s.StringBlock(e,"DELETE"),new s.FromTableBlock(t({},e,{singleTable:!0})),new s.JoinBlock(e),new s.WhereBlock(e),new s.OrderByBlock(e),new s.LimitBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,n))}return _inherits(r,e),r}(s.QueryBuilder),s.Insert=function(t){function e(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),r=r||[new s.StringBlock(t,"INSERT"),new s.IntoTableBlock(t),new s.InsertFieldValueBlock(t),new s.InsertFieldsFromQueryBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,r))}return _inherits(e,t),e}(s.QueryBuilder);var u={VERSION:"4.3.3",flavour:o,expr:function(t){return new s.Expression(t)},"case":function(t,e){return new s.Case(t,e)},select:function(t,e){return new s.Select(t,e)},update:function(t,e){return new s.Update(t,e)},insert:function(t,e){return new s.Insert(t,e)},"delete":function(t,e){return new s.Delete(t,e)},registerValueHandler:s.registerValueHandler,fval:s.fval};return u.remove=u["delete"],u.cls=s,u}var s=o();return s.flavours={},s.useFlavour=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(!t)return s;if(s.flavours[t]instanceof Function){var e=o(t);return s.flavours[t].call(null,e),e.flavours=s.flavours,e.useFlavour=s.useFlavour,e}throw new Error("Flavour not available: "+t)},s.flavours.mssql=function(e){var r=e.cls;r.DefaultQueryBuilderOptions.replaceSingleQuotes=!0,r.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,r.DefaultQueryBuilderOptions.numberedParametersPrefix="@",e.registerValueHandler(Date,function(t){return"'"+t.getUTCFullYear()+"-"+(t.getUTCMonth()+1)+"-"+t.getUTCDate()+" "+t.getUTCHours()+":"+t.getUTCMinutes()+":"+t.getUTCSeconds()+"'"}),r.MssqlLimitOffsetTopBlock=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));n.limits=null,n.offsets=null;var i=function(t){t=this._sanitizeLimitOffset(t),this._parent.limits=t};return n.ParentBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t.options));return r._parent=t,r}return _inherits(e,t),e}(r.Block),n.LimitBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.limit=i,r}return _inherits(e,t),_createClass(e,[{key:"buildStr",value:function(t){return this._parent.limits&&this._parent.offsets?"FETCH NEXT "+this._parent.limits+" ROWS ONLY":""}}]),e}(n.ParentBlock),n.TopBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.top=i,r}return _inherits(e,t),_createClass(e,[{key:"buildStr",value:function(t){return this._parent.limits&&!this._parent.offsets?"TOP ("+this._parent.limits+")":""}}]),e}(n.ParentBlock),n.OffsetBlock=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"offset",value:function(t){this._parent.offsets=this._sanitizeLimitOffset(t)}},{key:"buildStr",value:function(t){return this._parent.offsets?"OFFSET "+this._parent.offsets+" ROWS":""}}]),e}(n.ParentBlock),n}return _inherits(e,t),_createClass(e,[{key:"LIMIT",value:function(){return new this.LimitBlock(this)}},{key:"TOP",value:function(){return new this.TopBlock(this)}},{key:"OFFSET",value:function(){return new this.OffsetBlock(this)}}]),e}(r.Block),r.MssqlUpdateTopBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.limits=null,r.limit=r.top=function(t){r.limits=r._sanitizeLimitOffset(t)},r}return _inherits(e,t),_createClass(e,[{key:"buildStr",value:function(t){return this.limits?"TOP ("+this.limits+")":""}}]),e}(r.Block),r.MssqlInsertFieldValueBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.outputs=[],r}return _inherits(e,t),_createClass(e,[{key:"output",value:function(t){var e=this;"string"==typeof t?this.outputs.push("INSERTED."+this._sanitizeField(t)):t.forEach(function(t){e.outputs.push("INSERTED."+e._sanitizeField(t))})}},{key:"buildStr",value:function(t){if(0>=this.fields.length)throw new Error("set() needs to be called");var e=0!=this.outputs.length?"OUTPUT "+this.outputs.join(", ")+" ":"";return"("+this.fields.join(", ")+") "+e+"VALUES ("+this._buildVals().join("), (")+")"}},{key:"buildParam",value:function(t){if(0>=this.fields.length)throw new Error("set() needs to be called");var e="",r=this._buildValParams(),n=r.vals,i=r.params,l=!0,a=!1,o=void 0;try{for(var s,u=this.fields[Symbol.iterator]();!(l=(s=u.next()).done);l=!0){var c=s.value;e.length&&(e+=", "),e+=c}}catch(f){a=!0,o=f}finally{try{!l&&u["return"]&&u["return"]()}finally{if(a)throw o}}var h=0!=this.outputs.length?"OUTPUT "+this.outputs.join(", ")+" ":"";return{text:"("+e+") "+h+" VALUES ("+n.join("), (")+")",values:i}}}]),e}(r.InsertFieldValueBlock),r.MssqlUpdateDeleteOutputBlock=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r._outputs=[],r}return _inherits(e,t),_createClass(e,[{key:"outputs",value:function(t){for(var e in t)this.output(e,t[e])}},{key:"output",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];t=this._sanitizeField(t),e=e?this._sanitizeFieldAlias(e):e,this._outputs.push({name:this.options.forDelete?"DELETED."+t:"INSERTED."+t,alias:e})}},{key:"buildStr",value:function(t){var e="";if(this._outputs.length>0){var r=!0,n=!1,i=void 0;try{for(var l,a=this._outputs[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var o=l.value;e.length&&(e+=", "),e+=o.name,o.alias&&(e+=" AS "+o.alias)}}catch(s){n=!0,i=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}e="OUTPUT "+e}return e}}]),e}(r.Block),r.Select=function(e){function n(e){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];_classCallCheck(this,n);var l=new r.MssqlLimitOffsetTopBlock(e);return i=i||[new r.StringBlock(e,"SELECT"),new r.DistinctBlock(e),l.TOP(),new r.GetFieldBlock(e),new r.FromTableBlock(t({},e,{allowNested:!0})),new r.JoinBlock(t({},e,{allowNested:!0})),new r.WhereBlock(e),new r.GroupByBlock(e),new r.OrderByBlock(e),l.OFFSET(),l.LIMIT(),new r.UnionBlock(t({},e,{allowNested:!0}))],_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,i))}return _inherits(n,e),_createClass(n,[{key:"isNestable",value:function(){return!0}}]),n}(r.QueryBuilder),r.Update=function(t){function e(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),n=n||[new r.StringBlock(t,"UPDATE"),new r.MssqlUpdateTopBlock(t),new r.UpdateTableBlock(t),new r.SetFieldBlock(t),new r.MssqlUpdateDeleteOutputBlock(t),new r.WhereBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n))}return _inherits(e,t),e}(r.QueryBuilder),r.Delete=function(e){function n(e){var i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,n),i=i||[new r.StringBlock(e,"DELETE"),new r.FromTableBlock(t({},e,{singleTable:!0})),new r.JoinBlock(e),new r.MssqlUpdateDeleteOutputBlock(t({},e,{forDelete:!0})),new r.WhereBlock(e),new r.OrderByBlock(e),new r.LimitBlock(e)],_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,i))}return _inherits(n,e),n}(r.QueryBuilder),r.Insert=function(t){function e(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return _classCallCheck(this,e),n=n||[new r.StringBlock(t,"INSERT"),new r.IntoTableBlock(t),new r.MssqlInsertFieldValueBlock(t),new r.InsertFieldsFromQueryBlock(t)],_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n))}return _inherits(e,t),e}(r.QueryBuilder)},s});