/*! squel | https://github.com/hiddentao/squel | BSD license */!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.squel=e()}(this,function(){"use strict";function t(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return t.length?t+e:t}function l(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];if(t&&r){var i=!0,l=!1,o=void 0;try{for(var a,u=function(){var e=a.value;"object"===("undefined"==typeof e?"undefined":d(e))&&Object.getOwnPropertyNames(e).forEach(function(r){t[r]=e[r]})},s=r[Symbol.iterator]();!(i=(a=s.next()).done);i=!0)u()}catch(c){l=!0,o=c}finally{try{!i&&s["return"]&&s["return"]()}finally{if(l)throw o}}}return t}function o(t){return t&&t.constructor.prototype===Object.prototype}function a(t){return t&&t.constructor.prototype===Array.prototype}function u(t){if(!t)return t;if("function"==typeof t.clone)return t.clone();if(!o(t)&&!a(t))return JSON.parse(JSON.stringify(t));var e=function(){var e=new t.constructor;return Object.getOwnPropertyNames(t).forEach(function(r){"function"!=typeof t[r]&&(e[r]=u(t[r]))}),{v:e}}();return"object"===("undefined"==typeof e?"undefined":d(e))?e.v:void 0}function s(t,e,r){var n="undefined"==typeof e?"undefined":d(e);if("function"!==n&&"string"!==n)throw new Error("type must be a class constructor or string");if("function"!=typeof r)throw new Error("handler must be a function");var i=!0,l=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value;if(s.type===e)return void(s.handler=r)}}catch(c){l=!0,o=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw o}}t.push({type:e,handler:r})}function c(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];var i=!0,l=!1,o=void 0;try{for(var a,u=r[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=!0,f=!1,h=void 0;try{for(var v,p=s[Symbol.iterator]();!(c=(v=p.next()).done);c=!0){var y=v.value;if(("undefined"==typeof t?"undefined":d(t))===y.type||"string"!=typeof y.type&&t instanceof y.type)return y.handler}}catch(g){f=!0,h=g}finally{try{!c&&p["return"]&&p["return"]()}finally{if(f)throw h}}}}catch(g){l=!0,o=g}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw o}}}function f(){var f=arguments.length<=0||void 0===arguments[0]?null:arguments[0],p={isSquelBuilder:function(t){return t&&!!t._toParamString}},y=function(t){return!p.isSquelBuilder(t)||!t.options.rawNesting};p.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" ",stringFormatter:null,rawNesting:!1},p.globalValueHandlers=[],p.registerValueHandler=function(t,e){s(p.globalValueHandlers,t,e)},p.Cloneable=function(){function t(){n(this,t)}return v(t,[{key:"clone",value:function(){var t=new this.constructor;return l(t,u(l({},this)))}}]),t}(),p.BaseBuilder=function(i){function o(t){n(this,o);var r=e(this,Object.getPrototypeOf(o).call(this)),i=JSON.parse(JSON.stringify(p.DefaultQueryBuilderOptions));return r.options=l({},i,t),r}return r(o,i),v(o,[{key:"registerValueHandler",value:function(t,e){return s(this.options.valueHandlers,t,e),this}},{key:"_sanitizeExpression",value:function(t){if(!p.isSquelBuilder(t)&&"string"!=typeof t)throw new Error("expression must be a stringÂ or builder instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error(e+" must be a string");return t}},{key:"_sanitizeField",value:function(t){return p.isSquelBuilder(t)||(t=this._sanitizeName(t,"field name")),t}},{key:"_sanitizeBaseBuilder",value:function(t){if(p.isSquelBuilder(t))return t;throw new Error("must be a builder instance")}},{key:"_sanitizeTable",value:function(t){if("string"!=typeof t)try{t=this._sanitizeBaseBuilder(t)}catch(e){throw new Error("table name must be a string or a builder")}else t=this._sanitizeName(t,"table");return t}},{key:"_sanitizeTableAlias",value:function(t){return this._sanitizeName(t,"table alias")}},{key:"_sanitizeFieldAlias",value:function(t){return this._sanitizeName(t,"field alias")}},{key:"_sanitizeLimitOffset",value:function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e="undefined"==typeof t?"undefined":d(t);if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(p.isSquelBuilder(t));else{var r=!!c(t,this.options.valueHandlers,p.globalValueHandlers);if(!r)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatTableName",value:function(t){if(this.options.autoQuoteTableNames){var e=this.options.nameQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatFieldAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.fieldAliasQuoteCharacter;t=""+e+t+e}return t}},{key:"_formatTableAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.tableAliasQuoteCharacter;t=""+e+t+e}return this.options.useAsForTableAliasNames?"AS "+t:t}},{key:"_formatFieldName",value:function(t){var e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.options.autoQuoteFieldNames&&!function(){var n=e.options.nameQuoteCharacter;t=r.ignorePeriodsForFieldNameQuotes?""+n+t+n:t.split(".").map(function(t){return"*"===t?t:""+n+t+n}).join(".")}(),t}},{key:"_formatCustomValue",value:function(t,e,r){var n=c(t,this.options.valueHandlers,p.globalValueHandlers);return n&&(t=n(t,e,r)),{formatted:!!n,value:t}}},{key:"_formatValueForParamArray",value:function(t){var e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return a(t)?t.map(function(t){return e._formatValueForParamArray(t,r)}):this._formatCustomValue(t,!0,r).value}},{key:"_formatValueForQueryString",value:function(t){var e=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=this._formatCustomValue(t,!1,r),i=n.formatted,l=n.value;if(i)return this._applyNestingFormatting(l,y(t));if(a(l))l=l.map(function(t){return e._formatValueForQueryString(t)}),l=this._applyNestingFormatting(l.join(", "),y(l));else{var o="undefined"==typeof l?"undefined":d(l);if(null===l)l="NULL";else if("boolean"===o)l=l?"TRUE":"FALSE";else if(p.isSquelBuilder(l))l=this._applyNestingFormatting(l.toString(),y(l));else if("number"!==o){if("string"===o&&this.options.stringFormatter)return this.options.stringFormatter(l);if(r.dontQuote)l=""+l;else{var u=this._escapeValue(l);l="'"+u+"'"}}}return l}},{key:"_applyNestingFormatting",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(t&&"string"==typeof t&&e&&!this.options.rawNesting){var r="("===t.charAt(0)&&")"===t.charAt(t.length-1);if(r)for(var n=0,i=1;t.length-1>++n;){var l=t.charAt(n);if("("===l)i++;else if(")"===l&&(i--,1>i)){r=!1;break}}r||(t="("+t+")")}return t}},{key:"_buildString",value:function(e,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=n.nested,l=n.buildParameterized,o=n.formattingOptions;r=r||[],e=e||"";for(var u="",s=-1,c=[],f=this.options.parameterCharacter,h=0;e.length>h;)if(e.substr(h,f.length)===f){var v=r[++s];if(l)if(p.isSquelBuilder(v)){var d=v._toParamString({buildParameterized:l,nested:!0});u+=d.text,c.push.apply(c,t(d.values))}else if(v=this._formatValueForParamArray(v,o),a(v)){var y=v.map(function(){return f}).join(", ");u+="("+y+")",c.push.apply(c,t(v))}else u+=f,c.push(v);else u+=this._formatValueForQueryString(v,o);h+=f.length}else u+=e.charAt(h),h++;return{text:this._applyNestingFormatting(u,!!i),values:c}}},{key:"_buildManyStrings",value:function(e,r){for(var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=[],l=[],o=0;e.length>o;++o){var a=e[o],u=r[o],s=this._buildString(a,u,{buildParameterized:n.buildParameterized,nested:!1}),c=s.text,f=s.values;i.push(c),l.push.apply(l,t(f))}return i=i.join(this.options.separator),{text:i.length?this._applyNestingFormatting(i,!!n.nested):"",values:l}}},{key:"_toParamString",value:function(t){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(t).text}},{key:"toParam",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._toParamString(l({},t,{buildParameterized:!0}))}}]),o}(p.Cloneable),p.Expression=function(i){function l(t){n(this,l);var r=e(this,Object.getPrototypeOf(l).call(this,t));return r._nodes=[],r}return r(l,i),v(l,[{key:"and",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return t=this._sanitizeExpression(t),this._nodes.push({type:"AND",expr:t,para:r}),this}},{key:"or",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return t=this._sanitizeExpression(t),this._nodes.push({type:"OR",expr:t,para:r}),this}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=[],n=[],i=!0,l=!1,o=void 0;try{for(var a,u=this._nodes[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=s.type,f=s.expr,h=s.para,v=p.isSquelBuilder(f)?f._toParamString({buildParameterized:e.buildParameterized,nested:!0}):this._buildString(f,h,{buildParameterized:e.buildParameterized}),d=v.text,y=v.values;r.length&&r.push(c),r.push(d),n.push.apply(n,t(y))}}catch(g){l=!0,o=g}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw o}}return r=r.join(" "),{text:this._applyNestingFormatting(r,!!e.nested),values:n}}}]),l}(p.BaseBuilder),p.Case=function(a){function u(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];n(this,u);var i=e(this,Object.getPrototypeOf(u).call(this,r));return o(t)&&(r=t,t=null),t&&(i._fieldName=i._sanitizeField(t)),i.options=l({},p.DefaultQueryBuilderOptions,r),i._cases=[],i._elseValue=null,i}return r(u,a),v(u,[{key:"when",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];return this._cases.unshift({expression:t,values:r}),this}},{key:"then",value:function(t){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}},{key:"else",value:function(t){return this._elseValue=t,this}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],l=!0,o=!1,a=void 0;try{for(var u,s=this._cases[Symbol.iterator]();!(l=(u=s.next()).done);l=!0){var c=u.value,f=c.expression,h=c.values,v=c.result;r=i(r," ");var d=this._buildString(f,h,{buildParameterized:e.buildParameterized,nested:!0});r+="WHEN "+d.text+" THEN "+this._formatValueForQueryString(v),n.push.apply(n,t(d.values))}}catch(p){o=!0,a=p}finally{try{!l&&s["return"]&&s["return"]()}finally{if(o)throw a}}return r.length?(r+=" ELSE "+this._formatValueForQueryString(this._elseValue)+" END",this._fieldName&&(r=this._fieldName+" "+r),r="CASE "+r):r=this._formatValueForQueryString(this._elseValue),{text:r,values:n}}}]),u}(p.BaseBuilder),p.Block=function(t){function i(t){return n(this,i),e(this,Object.getPrototypeOf(i).call(this,t))}return r(i,t),v(i,[{key:"exposedMethods",value:function(){for(var t={},e=this;e;)Object.getOwnPropertyNames(e).forEach(function(r){"constructor"===r||"function"!=typeof e[r]||"_"===r.charAt(0)||p.Block.prototype[r]||(t[r]=e[r])}),e=Object.getPrototypeOf(e);return t}}]),i}(p.BaseBuilder),p.StringBlock=function(t){function i(t,r){n(this,i);var l=e(this,Object.getPrototypeOf(i).call(this,t));return l._str=r,l}return r(i,t),v(i,[{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._str,values:[]}}}]),i}(p.Block),p.FunctionBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._strings=[],r._values=[],r}return r(i,t),v(i,[{key:"function",value:function(t){this._strings.push(t);for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._values.push(r)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this._buildManyStrings(this._strings,this._values,t)}}]),i}(p.Block),p.registerValueHandler(p.FunctionBlock,function(t){var e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return e?t.toParam():t.toString()}),p.AbstractTableBlock=function(l){function o(t,r){n(this,o);var i=e(this,Object.getPrototypeOf(o).call(this,t));return i._tables=[],i}return r(o,l),v(o,[{key:"_table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[];if(this._hasTable()){var l=!0,o=!1,a=void 0;try{for(var u,s=this._tables[Symbol.iterator]();!(l=(u=s.next()).done);l=!0){var c=u.value,f=c.table,h=c.alias;r=i(r,", ");var v=void 0;if(p.isSquelBuilder(f)){var d=f._toParamString({buildParameterized:e.buildParameterized,nested:!0}),y=d.text,g=d.values;v=y,n.push.apply(n,t(g))}else v=this._formatTableName(f);h&&(v+=" "+this._formatTableAlias(h)),r+=v}}catch(_){o=!0,a=_}finally{try{!l&&s["return"]&&s["return"]()}finally{if(o)throw a}}this.options.prefix&&(r=this.options.prefix+" "+r)}return{text:r,values:n}}}]),o}(p.Block),p.TargetTableBlock=function(t){function i(){return n(this,i),e(this,Object.getPrototypeOf(i).apply(this,arguments))}return r(i,t),v(i,[{key:"target",value:function(t){this._table(t)}}]),i}(p.AbstractTableBlock),p.UpdateTableBlock=function(t){function i(){return n(this,i),e(this,Object.getPrototypeOf(i).apply(this,arguments))}return r(i,t),v(i,[{key:"table",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("table() needs to be called");return h(Object.getPrototypeOf(i.prototype),"_toParamString",this).call(this,t)}}]),i}(p.AbstractTableBlock),p.FromTableBlock=function(t){function i(t){return n(this,i),e(this,Object.getPrototypeOf(i).call(this,l({},t,{prefix:"FROM"})))}return r(i,t),v(i,[{key:"from",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this._table(t,e)}}]),i}(p.AbstractTableBlock),p.IntoTableBlock=function(t){function i(t){return n(this,i),e(this,Object.getPrototypeOf(i).call(this,l({},t,{prefix:"INTO",singleTable:!0})))}return r(i,t),v(i,[{key:"into",value:function(t){this._table(t)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this._hasTable())throw new Error("into() needs to be called");return h(Object.getPrototypeOf(i.prototype),"_toParamString",this).call(this,t)}}]),i}(p.AbstractTableBlock),p.GetFieldBlock=function(l){function o(t){n(this,o);var r=e(this,Object.getPrototypeOf(o).call(this,t));return r._fields=[],r}return r(o,l),v(o,[{key:"fields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(a(t)){var r=!0,n=!1,i=void 0;try{for(var l,o=t[Symbol.iterator]();!(r=(l=o.next()).done);r=!0){var u=l.value;this.field(u,null,e)}}catch(s){n=!0,i=s}finally{try{!r&&o["return"]&&o["return"]()}finally{if(n)throw i}}}else for(var c in t){var f=t[c];this.field(c,f,e)}}},{key:"field",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);var n=this._fields.filter(function(r){return r.name===t&&r.alias===e});return n.length?this:void this._fields.push({name:t,alias:e,options:r})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.queryBuilder,n=e.buildParameterized,l="",o=[],a=!0,u=!1,s=void 0;try{for(var c,f=this._fields[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var h=c.value;l=i(l,", ");var v=h.name,d=h.alias,y=h.options;if("string"==typeof v)l+=this._formatFieldName(v,y);else{var g=v._toParamString({nested:!0,buildParameterized:n});l+=g.text,o.push.apply(o,t(g.values))}d&&(l+=" AS "+this._formatFieldAlias(d))}}catch(_){u=!0,s=_}finally{try{!a&&f["return"]&&f["return"]()}finally{if(u)throw s}}if(!l.length){var m=r&&r.getBlock(p.FromTableBlock);m&&m._hasTable()&&(l="*")}return{text:l,values:o}}}]),o}(p.Block),p.AbstractSetFieldBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._reset(),r}return r(i,t),v(i,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(this._values.length>1)throw new Error("Cannot set multiple rows of fields this way.");"undefined"!=typeof e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);var n=this._fields.indexOf(t);-1===n&&(this._fields.push(t),n=this._fields.length-1),this._values[0][n]=e,this._valueOptions[0][n]=r}},{key:"_setFields",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==("undefined"==typeof t?"undefined":d(t)))throw new Error("Expected an object but got "+("undefined"==typeof t?"undefined":d(t)));for(var r in t)this._set(r,t[r],e)}},{key:"_setFieldsRows",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!a(t))throw new Error("Expected an array of objects but got "+("undefined"==typeof t?"undefined":d(t)));this._reset();for(var r=0;t.length>r;++r){var n=t[r];for(var i in n){var l=n[i];i=this._sanitizeField(i),l=this._sanitizeValue(l);var o=this._fields.indexOf(i);if(r>0&&-1===o)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===o&&(this._fields.push(i),o=this._fields.length-1),a(this._values[r])||(this._values[r]=[],this._valueOptions[r]=[]),this._values[r][o]=l,this._valueOptions[r][o]=e}}}}]),i}(p.Block),p.SetFieldBlock=function(l){function o(){return n(this,o),e(this,Object.getPrototypeOf(o).apply(this,arguments))}return r(o,l),v(o,[{key:"set",value:function(t,e,r){this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=e.buildParameterized;if(0>=this._fields.length)throw new Error("set() needs to be called");for(var n="",l=[],o=0;o<this._fields.length;++o){n=i(n,", ");var a=this._formatFieldName(this._fields[o]),u=this._values[0][o];0>a.indexOf("=")&&(a=a+" = "+this.options.parameterCharacter);var s=this._buildString(a,[u],{buildParameterized:r,formattingOptions:this._valueOptions[0][o]});n+=s.text,l.push.apply(l,t(s.values))}return{text:"SET "+n,values:l}}}]),o}(p.AbstractSetFieldBlock),p.InsertFieldValueBlock=function(l){function o(){return n(this,o),e(this,Object.getPrototypeOf(o).apply(this,arguments))}return r(o,l),v(o,[{key:"set",value:function(t,e){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this._set(t,e,r)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_toParamString",value:function(){for(var e=this,r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=r.buildParameterized,l=this._fields.map(function(t){return e._formatFieldName(t)}).join(", "),o=[],a=[],u=0;u<this._values.length;++u){o[u]="";for(var s=0;s<this._values[u].length;++s){var c=this._buildString(this.options.parameterCharacter,[this._values[u][s]],{buildParameterized:n,formattingOptions:this._valueOptions[u][s]});a.push.apply(a,t(c.values)),o[u]=i(o[u],", "),o[u]+=c.text}}return{text:l.length?"("+l+") VALUES ("+o.join("), (")+")":"",values:a}}}]),o}(p.AbstractSetFieldBlock),p.InsertFieldsFromQueryBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._fields=[],r._query=null,r}return r(i,t),v(i,[{key:"fromQuery",value:function(t,e){var r=this;this._fields=t.map(function(t){return r._sanitizeField(t)}),this._query=this._sanitizeBaseBuilder(e)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e="",r=[];if(this._fields.length&&this._query){var n=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0}),i=n.text,l=n.values;e="("+this._fields.join(", ")+") "+this._applyNestingFormatting(i),r=l}return{text:e,values:r}}}]),i}(p.Block),p.DistinctBlock=function(t){function i(){return n(this,i),e(this,Object.getPrototypeOf(i).apply(this,arguments))}return r(i,t),v(i,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),i}(p.Block),p.GroupByBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._groups=[],r}return r(i,t),v(i,[{key:"group",value:function(t){this._groups.push(this._sanitizeField(t))}},{key:"_toParamString",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{text:this._groups.length?"GROUP BY "+this._groups.join(", "):"",values:[]}}}]),i}(p.Block),p.AbstractVerbSingleValueBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._value=0,r}return r(i,t),v(i,[{key:"_setValue",value:function(t){this._value=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=0<this._value?this.options.verb+" "+this.options.parameterCharacter:"",r=null!==this._value?[this._value]:[];return this._buildString(e,r,t)}}]),i}(p.Block),p.OffsetBlock=function(t){function i(t){return n(this,i),e(this,Object.getPrototypeOf(i).call(this,l({},t,{verb:"OFFSET"})))}return r(i,t),v(i,[{key:"offset",value:function(t){this._setValue(t)}}]),i}(p.AbstractVerbSingleValueBlock),p.LimitBlock=function(t){function i(t){return n(this,i),e(this,Object.getPrototypeOf(i).call(this,l({},t,{verb:"LIMIT"})))}return r(i,t),v(i,[{key:"limit",value:function(t){this._setValue(t)}}]),i}(p.AbstractVerbSingleValueBlock),p.AbstractConditionBlock=function(i){function l(t){n(this,l);var r=e(this,Object.getPrototypeOf(l).call(this,t));return r._conditions=[],r}return r(l,i),v(l,[{key:"_condition",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];t=this._sanitizeExpression(t),this._conditions.push({expr:t,values:r})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=[],n=[],i=!0,l=!1,o=void 0;try{for(var a,u=this._conditions[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=s.expr,f=s.values,h=p.isSquelBuilder(c)?c._toParamString({buildParameterized:e.buildParameterized}):this._buildString(c,f,{buildParameterized:e.buildParameterized});h.text.length&&r.push(h.text),n.push.apply(n,t(h.values))}}catch(v){l=!0,o=v}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw o}}return r.length&&(r=r.join(") AND (")),{text:r.length?this.options.verb+" ("+r+")":"",values:n}}}]),l}(p.Block),p.WhereBlock=function(t){function i(t){return n(this,i),e(this,Object.getPrototypeOf(i).call(this,l({},t,{verb:"WHERE"})))}return r(i,t),v(i,[{key:"where",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[t].concat(r))}}]),i}(p.AbstractConditionBlock),p.HavingBlock=function(t){function i(t){return n(this,i),e(this,Object.getPrototypeOf(i).call(this,l({},t,{verb:"HAVING"})))}return r(i,t),v(i,[{key:"having",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];this._condition.apply(this,[t].concat(r))}}]),i}(p.AbstractConditionBlock),p.OrderByBlock=function(l){function o(t){n(this,o);var r=e(this,Object.getPrototypeOf(o).call(this,t));return r._orders=[],r}return r(o,l),v(o,[{key:"order",value:function(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;r>i;i++)n[i-2]=arguments[i];t=this._sanitizeField(t),"string"!=typeof e&&(void 0===e?e="ASC":null!==e&&(e=e?"ASC":"DESC")),this._orders.push({field:t,dir:e,values:n})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],l=!0,o=!1,a=void 0;try{for(var u,s=this._orders[Symbol.iterator]();!(l=(u=s.next()).done);l=!0){var c=u.value,f=c.field,h=c.dir,v=c.values;r=i(r,", ");var d=this._buildString(f,v,{buildParameterized:e.buildParameterized});r+=d.text,n.push.apply(n,t(d.values)),null!==h&&(r+=" "+h)}}catch(p){o=!0,a=p}finally{try{!l&&s["return"]&&s["return"]()}finally{if(o)throw a}}return{text:r.length?"ORDER BY "+r:"",values:n}}}]),o}(p.Block),p.JoinBlock=function(l){function o(t){n(this,o);var r=e(this,Object.getPrototypeOf(o).call(this,t));return r._joins=[],r}return r(o,l),v(o,[{key:"join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=arguments.length<=3||void 0===arguments[3]?"INNER":arguments[3];t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,r=r?this._sanitizeExpression(r):r,this._joins.push({type:n,table:t,alias:e,condition:r})}},{key:"left_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"LEFT")}},{key:"right_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"RIGHT")}},{key:"outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"OUTER")}},{key:"left_outer_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"FULL")}},{key:"cross_join",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.join(t,e,r,"CROSS")}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],l=!0,o=!1,a=void 0;try{for(var u,s=this._joins[Symbol.iterator]();!(l=(u=s.next()).done);l=!0){var c=u.value,f=c.type,h=c.table,v=c.alias,d=c.condition;r=i(r,this.options.separator);var y=void 0;if(p.isSquelBuilder(h)){var g=h._toParamString({buildParameterized:e.buildParameterized,nested:!0});n.push.apply(n,t(g.values)),y=g.text}else y=this._formatTableName(h);if(r+=f+" JOIN "+y,v&&(r+=" "+this._formatTableAlias(v)),d){r+=" ON ";var _=void 0;_=p.isSquelBuilder(d)?d._toParamString({buildParameterized:e.buildParameterized}):this._buildString(d,[],{buildParameterized:e.buildParameterized}),r+=this._applyNestingFormatting(_.text),n.push.apply(n,t(_.values))}}}catch(m){o=!0,a=m}finally{try{!l&&s["return"]&&s["return"]()}finally{if(o)throw a}}return{text:r,values:n}}}]),o}(p.Block),p.UnionBlock=function(l){function o(t){n(this,o);var r=e(this,Object.getPrototypeOf(o).call(this,t));return r._unions=[],r}return r(o,l),v(o,[{key:"union",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"UNION":arguments[1];t=this._sanitizeTable(t),this._unions.push({type:e,table:t})}},{key:"union_all",value:function(t){this.union(t,"UNION ALL")}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],l=!0,o=!1,a=void 0;try{for(var u,s=this._unions[Symbol.iterator]();!(l=(u=s.next()).done);l=!0){var c=u.value,f=c.type,h=c.table;r=i(r,this.options.separator);var v=void 0;if(h instanceof p.BaseBuilder){var d=h._toParamString({buildParameterized:e.buildParameterized,nested:!0});v=d.text,n.push.apply(n,t(d.values))}else r=this._formatTableName(h);r+=f+" "+v}}catch(y){o=!0,a=y}finally{try{!l&&s["return"]&&s["return"]()}finally{if(o)throw a}}return{text:r,values:n}}}]),o}(p.Block),p.QueryBuilder=function(i){function o(t,r){n(this,o);var i=e(this,Object.getPrototypeOf(o).call(this,t));i.blocks=r||[];var l=!0,a=!1,u=void 0;try{for(var s,c=i.blocks[Symbol.iterator]();!(l=(s=c.next()).done);l=!0){var f=s.value,h=f.exposedMethods();for(var v in h){var d=h[v];if(void 0!==i[v])throw new Error("Builder already has a builder method called: "+v);!function(t,e,r){i[e]=function(){for(var e=arguments.length,n=Array(e),l=0;e>l;l++)n[l]=arguments[l];return r.call.apply(r,[t].concat(n)),i}}(f,v,d)}}}catch(p){a=!0,u=p}finally{try{!l&&c["return"]&&c["return"]()}finally{if(a)throw u}}return i}return r(o,i),v(o,[{key:"registerValueHandler",value:function(t,e){var r=!0,n=!1,i=void 0;try{for(var l,a=this.blocks[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var u=l.value;u.registerValueHandler(t,e)}}catch(s){n=!0,i=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw i}}return h(Object.getPrototypeOf(o.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(t){this.options=l({},this.options,t);var e=!0,r=!1,n=void 0;try{for(var i,o=this.blocks[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;a.options=l({},a.options,t)}}catch(u){r=!0,n=u}finally{try{!e&&o["return"]&&o["return"]()}finally{if(r)throw n}}}},{key:"_toParamString",value:function(){var e,r=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];n=l({},this.options,n);var i=this.blocks.map(function(t){return t._toParamString({buildParameterized:n.buildParameterized,queryBuilder:r})}),o=i.map(function(t){return t.text}),a=i.map(function(t){return t.values}),u=o.filter(function(t){return 0<t.length}).join(n.separator),s=(e=[]).concat.apply(e,t(a));return n.nested||n.numberedParameters&&!function(){var t=void 0!==n.numberedParametersStartAt?n.numberedParametersStartAt:1,e=n.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");u=u.replace(new RegExp(e,"g"),function(){return""+n.numberedParametersPrefix+t++})}(),{text:this._applyNestingFormatting(u,!!n.nested),values:s}}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"getBlock",value:function(t){var e=this.blocks.filter(function(e){return e instanceof t});return e[0]}}]),o}(p.BaseBuilder),p.Select=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new p.StringBlock(t,"SELECT"),new p.FunctionBlock(t),new p.DistinctBlock(t),new p.GetFieldBlock(t),new p.FromTableBlock(t),new p.JoinBlock(t),new p.WhereBlock(t),new p.GroupByBlock(t),new p.HavingBlock(t),new p.OrderByBlock(t),new p.LimitBlock(t),new p.OffsetBlock(t),new p.UnionBlock(t)],
e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(p.QueryBuilder),p.Update=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new p.StringBlock(t,"UPDATE"),new p.UpdateTableBlock(t),new p.SetFieldBlock(t),new p.WhereBlock(t),new p.OrderByBlock(t),new p.LimitBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(p.QueryBuilder),p.Delete=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new p.StringBlock(t,"DELETE"),new p.TargetTableBlock(t),new p.FromTableBlock(l({},t,{singleTable:!0})),new p.JoinBlock(t),new p.WhereBlock(t),new p.OrderByBlock(t),new p.LimitBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(p.QueryBuilder),p.Insert=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new p.StringBlock(t,"INSERT"),new p.IntoTableBlock(t),new p.InsertFieldValueBlock(t),new p.InsertFieldsFromQueryBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(p.QueryBuilder);var g={VERSION:"5.8.0",flavour:f,expr:function(t){return new p.Expression(t)},"case":function(t,e){return new p.Case(t,e)},select:function(t,e){return new p.Select(t,e)},update:function(t,e){return new p.Update(t,e)},insert:function(t,e){return new p.Insert(t,e)},"delete":function(t,e){return new p.Delete(t,e)},str:function(){var t=new p.FunctionBlock;return t["function"].apply(t,arguments),t},rstr:function(){var t=new p.FunctionBlock({rawNesting:!0});return t["function"].apply(t,arguments),t},registerValueHandler:p.registerValueHandler};return g.remove=g["delete"],g.cls=p,g}var h=function y(t,e,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:y(i,e,r)}if("value"in n)return n.value;var l=n.get;if(void 0!==l)return l.call(r)},v=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},p=f();return p.flavours={},p.useFlavour=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(!t)return p;if(p.flavours[t]instanceof Function){var e=f(t);return p.flavours[t].call(null,e),e.flavours=p.flavours,e.useFlavour=p.useFlavour,e}throw new Error("Flavour not available: "+t)},p.flavours.mssql=function(t){var o=t.cls;o.DefaultQueryBuilderOptions.replaceSingleQuotes=!0,o.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,o.DefaultQueryBuilderOptions.numberedParametersPrefix="@",t.registerValueHandler(Date,function(t){return"'"+t.getUTCFullYear()+"-"+(t.getUTCMonth()+1)+"-"+t.getUTCDate()+" "+t.getUTCHours()+":"+t.getUTCMinutes()+":"+t.getUTCSeconds()+"'"}),o.MssqlLimitOffsetTopBlock=function(t){function i(t){n(this,i);var l=e(this,Object.getPrototypeOf(i).call(this,t));l._limits=null,l._offsets=null;var a=function(t){t=this._sanitizeLimitOffset(t),this._parent._limits=t};return l.ParentBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t.options));return r._parent=t,r}return r(i,t),i}(o.Block),l.LimitBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r.limit=a,r}return r(i,t),v(i,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&this._parent._offsets&&(t="FETCH NEXT "+this._parent._limits+" ROWS ONLY"),{text:t,values:[]}}}]),i}(l.ParentBlock),l.TopBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r.top=a,r}return r(i,t),v(i,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&!this._parent._offsets&&(t="TOP ("+this._parent._limits+")"),{text:t,values:[]}}}]),i}(l.ParentBlock),l.OffsetBlock=function(t){function i(){return n(this,i),e(this,Object.getPrototypeOf(i).apply(this,arguments))}return r(i,t),v(i,[{key:"offset",value:function(t){this._parent._offsets=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t="";return this._parent._offsets&&(t="OFFSET "+this._parent._offsets+" ROWS"),{text:t,values:[]}}}]),i}(l.ParentBlock),l}return r(i,t),v(i,[{key:"LIMIT",value:function(){return new this.LimitBlock(this)}},{key:"TOP",value:function(){return new this.TopBlock(this)}},{key:"OFFSET",value:function(){return new this.OffsetBlock(this)}}]),i}(o.Block),o.MssqlUpdateTopBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._limits=null,r.limit=r.top=function(t){r._limits=r._sanitizeLimitOffset(t)},r}return r(i,t),v(i,[{key:"_toParamString",value:function(){return{text:this._limits?"TOP ("+this._limits+")":"",values:[]}}}]),i}(o.Block),o.MssqlInsertFieldValueBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._outputs=[],r}return r(i,t),v(i,[{key:"output",value:function(t){var e=this;"string"==typeof t?this._outputs.push("INSERTED."+this._sanitizeField(t)):t.forEach(function(t){e._outputs.push("INSERTED."+e._sanitizeField(t))})}},{key:"_toParamString",value:function(t){var e=h(Object.getPrototypeOf(i.prototype),"_toParamString",this).call(this,t);if(e.text.length&&0<this._outputs.length){var r="OUTPUT "+this._outputs.join(", ")+" ",n=e.text.indexOf("VALUES");e.text=e.text.substr(0,n)+r+e.text.substr(n)}return e}}]),i}(o.InsertFieldValueBlock),o.MssqlUpdateDeleteOutputBlock=function(t){function l(t){n(this,l);var r=e(this,Object.getPrototypeOf(l).call(this,t));return r._outputs=[],r}return r(l,t),v(l,[{key:"outputs",value:function(t){for(var e in t)this.output(e,t[e])}},{key:"output",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];t=this._sanitizeField(t),e=e?this._sanitizeFieldAlias(e):e,this._outputs.push({name:this.options.forDelete?"DELETED."+t:"INSERTED."+t,alias:e})}},{key:"_toParamString",value:function(t){var e="";if(this._outputs.length){var r=!0,n=!1,l=void 0;try{for(var o,a=this._outputs[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;e=i(e,", "),e+=u.name,u.alias&&(e+=" AS "+this._formatFieldAlias(u.alias))}}catch(s){n=!0,l=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(n)throw l}}e="OUTPUT "+e}return{text:e,values:[]}}}]),l}(o.Block),o.Select=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];n(this,i);var l=new o.MssqlLimitOffsetTopBlock(t);return r=r||[new o.StringBlock(t,"SELECT"),new o.DistinctBlock(t),l.TOP(),new o.GetFieldBlock(t),new o.FromTableBlock(t),new o.JoinBlock(t),new o.WhereBlock(t),new o.GroupByBlock(t),new o.OrderByBlock(t),l.OFFSET(),l.LIMIT(),new o.UnionBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(o.QueryBuilder),o.Update=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new o.StringBlock(t,"UPDATE"),new o.MssqlUpdateTopBlock(t),new o.UpdateTableBlock(t),new o.SetFieldBlock(t),new o.MssqlUpdateDeleteOutputBlock(t),new o.WhereBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(o.QueryBuilder),o.Delete=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new o.StringBlock(t,"DELETE"),new o.TargetTableBlock(t),new o.FromTableBlock(l({},t,{singleTable:!0})),new o.JoinBlock(t),new o.MssqlUpdateDeleteOutputBlock(l({},t,{forDelete:!0})),new o.WhereBlock(t),new o.OrderByBlock(t),new o.LimitBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(o.QueryBuilder),o.Insert=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new o.StringBlock(t,"INSERT"),new o.IntoTableBlock(t),new o.MssqlInsertFieldValueBlock(t),new o.InsertFieldsFromQueryBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(o.QueryBuilder)},p.flavours.mysql=function(l){var o=l.cls;o.MysqlOnDuplicateKeyUpdateBlock=function(l){function o(){return n(this,o),e(this,Object.getPrototypeOf(o).apply(this,arguments))}return r(o,l),v(o,[{key:"onDupUpdate",value:function(t,e,r){this._set(t,e,r)}},{key:"_toParamString",value:function(){for(var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],l=0;l<this._fields.length;++l){r=i(r,", ");var o=this._fields[l],a=this._values[0][l],u=this._valueOptions[0][l];if("undefined"==typeof a)r+=o;else{var s=this._buildString(o+" = "+this.options.parameterCharacter,[a],{buildParameterized:e.buildParameterized,formattingOptions:u});r+=s.text,n.push.apply(n,t(s.values))}}return{text:r.length?"ON DUPLICATE KEY UPDATE "+r:"",values:n}}}]),o}(o.AbstractSetFieldBlock),o.Insert=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new o.StringBlock(t,"INSERT"),new o.IntoTableBlock(t),new o.InsertFieldValueBlock(t),new o.InsertFieldsFromQueryBlock(t),new o.MysqlOnDuplicateKeyUpdateBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(o.QueryBuilder),o.Replace=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new o.StringBlock(t,"REPLACE"),new o.IntoTableBlock(t),new o.InsertFieldValueBlock(t),new o.InsertFieldsFromQueryBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(o.QueryBuilder),l.replace=function(t,e){return new o.Replace(t,e)}},p.flavours.postgres=function(o){var a=o.cls;a.DefaultQueryBuilderOptions.numberedParameters=!0,a.DefaultQueryBuilderOptions.numberedParametersStartAt=1,a.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,a.DefaultQueryBuilderOptions.useAsForTableAliasNames=!0,a.PostgresOnConflictKeyUpdateBlock=function(l){function o(){return n(this,o),e(this,Object.getPrototypeOf(o).apply(this,arguments))}return r(o,l),v(o,[{key:"onConflict",value:function(t,e){var r=this;this._dupIndex=this._sanitizeField(t),e&&Object.keys(e).forEach(function(t){r._set(t,e[t])})}},{key:"_toParamString",value:function(){for(var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r="",n=[],l=0;l<this._fields.length;++l){r=i(r,", ");var o=this._fields[l],a=this._values[0][l],u=this._valueOptions[0][l];if("undefined"==typeof a)r+=o;else{var s=this._buildString(o+" = "+this.options.parameterCharacter,[a],{buildParameterized:e.buildParameterized,formattingOptions:u});r+=s.text,n.push.apply(n,t(s.values))}}return{text:this._dupIndex?"ON CONFLICT ("+this._dupIndex+") DO "+(r.length?"UPDATE SET "+r:"NOTHING"):"",values:n}}}]),o}(a.AbstractSetFieldBlock),a.ReturningBlock=function(l){function o(t){n(this,o);var r=e(this,Object.getPrototypeOf(o).call(this,t));return r._fields=[],r}return r(o,l),v(o,[{key:"returning",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);var n=this._fields.filter(function(r){return r.name===t&&r.alias===e});return n.length?this:void this._fields.push({name:t,alias:e,options:r})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=(e.queryBuilder,e.buildParameterized),n="",l=[],o=!0,a=!1,u=void 0;try{for(var s,c=this._fields[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var f=s.value;n=i(n,", ");var h=f.name,v=f.alias,d=f.options;if("string"==typeof h)n+=this._formatFieldName(h,d);else{var p=h._toParamString({nested:!0,buildParameterized:r});n+=p.text,l.push.apply(l,t(p.values))}v&&(n+=" AS "+this._formatFieldAlias(v))}}catch(y){a=!0,u=y}finally{try{!o&&c["return"]&&c["return"]()}finally{if(a)throw u}}return{text:n.length>0?"RETURNING "+n:"",values:l}}}]),o}(a.Block),a.WithBlock=function(i){function l(t){n(this,l);var r=e(this,Object.getPrototypeOf(l).call(this,t));return r._tables=[],r}return r(l,i),v(l,[{key:"with",value:function(t,e){this._tables.push({alias:t,table:e})}},{key:"_toParamString",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=[],n=[],i=!0,l=!1,o=void 0;try{for(var a,u=this._tables[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var s=a.value,c=s.alias,f=s.table,h=f._toParamString({buildParameterized:e.buildParameterized,nested:!0});r.push(c+" AS "+h.text),n.push.apply(n,t(h.values))}}catch(v){l=!0,o=v}finally{try{!i&&u["return"]&&u["return"]()}finally{if(l)throw o}}return{text:r.length?"WITH "+r.join(", "):"",values:n}}}]),l}(a.Block),a.DistinctOnBlock=function(t){function i(t){n(this,i);var r=e(this,Object.getPrototypeOf(i).call(this,t));return r._distinctFields=[],r}return r(i,t),v(i,[{key:"distinct",value:function(){var t=this;this._useDistinct=!0;for(var e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];r.forEach(function(e){t._distinctFields.push(t._sanitizeField(e))})}},{key:"_toParamString",value:function(){var t="";return this._useDistinct&&(t="DISTINCT",this._distinctFields.length&&(t+=" ON ("+this._distinctFields.join(", ")+")")),{text:t,values:[]}}}]),i}(a.Block),a.Select=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new a.WithBlock(t),new a.StringBlock(t,"SELECT"),new a.FunctionBlock(t),new a.DistinctOnBlock(t),new a.GetFieldBlock(t),new a.FromTableBlock(t),new a.JoinBlock(t),new a.WhereBlock(t),new a.GroupByBlock(t),new a.HavingBlock(t),new a.OrderByBlock(t),new a.LimitBlock(t),new a.OffsetBlock(t),new a.UnionBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(a.QueryBuilder),a.Insert=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new a.WithBlock(t),new a.StringBlock(t,"INSERT"),new a.IntoTableBlock(t),new a.InsertFieldValueBlock(t),new a.InsertFieldsFromQueryBlock(t),new a.PostgresOnConflictKeyUpdateBlock(t),new a.ReturningBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(a.QueryBuilder),a.Update=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new a.WithBlock(t),new a.StringBlock(t,"UPDATE"),new a.UpdateTableBlock(t),new a.SetFieldBlock(t),new a.FromTableBlock(t),new a.WhereBlock(t),new a.OrderByBlock(t),new a.LimitBlock(t),new a.ReturningBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(a.QueryBuilder),a.Delete=function(t){function i(t){var r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n(this,i),r=r||[new a.WithBlock(t),new a.StringBlock(t,"DELETE"),new a.TargetTableBlock(t),new a.FromTableBlock(l({},t,{singleTable:!0})),new a.JoinBlock(t),new a.WhereBlock(t),new a.OrderByBlock(t),new a.LimitBlock(t),new a.ReturningBlock(t)],e(this,Object.getPrototypeOf(i).call(this,t,r))}return r(i,t),i}(a.QueryBuilder)},p});